# EarthLord 游戏设计文档（GDD）

## 1. 游戏概述

### 1.1 基本信息

| 项目 | 说明 |
|------|------|
| 游戏名称 | EarthLord（地球领主） |
| 游戏类型 | LBS生存策略 / Walk to Earn |
| 目标平台 | iOS |
| 视觉风格 | 希望朋克（Hope Punk） |
| 核心玩法 | GPS圈地 + 探索搜刮 + 建造经营 + 社交通讯 |
| 对标产品 | 宝可梦GO × 饥荒 × 部落冲突 |

### 1.2 游戏概念
在末日废土上，玩家通过现实中的步行来圈占领地、探索废墟搜刮资源、建造建筑重建家园，并与其他幸存者交易和通讯。**你在现实中的每一步，都是游戏中重建文明的一步。**

### 1.3 核心体验支柱
1. **真实行走**：现实世界的每一步都有游戏价值
2. **领地经营**：从一无所有到建立自己的家园
3. **生存压力**：体征衰减制造紧迫感，驱动持续游玩
4. **社交协作**：通讯、交易、排行，连接全球玩家

---

## 2. 世界观与叙事

### 2.1 背景故事

**2048年** — "终末战争"爆发，全球文明在72小时内崩塌，99%的人口消失。

**2051年** — 幸存者们从废墟中走出。旧世界的秩序已经不存在了，取而代之的是一条全新的法则——《新开拓者协议》：

> **"凡以双足丈量之无主土地，皆为开拓者所有。"**

玩家作为一名刚从避难所醒来的幸存者，在这个新世界中用双脚开拓自己的家园。

### 2.2 视觉风格——希望朋克

| 元素 | 表现 |
|------|------|
| 色调 | 废土灰棕为底，点缀鲜明的绿色和暖光 |
| 地图 | 卫星地图叠加末日风格滤镜 |
| 建筑 | 破败结构上的新生建造，铁锈+绿植+霓虹 |
| UI | 粗犷工业风+温暖的希望色彩 |
| 情绪 | 不是绝望，是废土之上的重建与希望 |

### 2.3 叙事结构
游戏通过功能解锁渐进展开叙事：

1. **觉醒**（登录）：从避难所醒来，登记身份
2. **开拓**（圈地）：踏出第一步，用双脚丈量土地
3. **搜刮**（探索）：在废墟中发现物资
4. **建设**（建造）：从篝火到庇护所，重建家园
5. **连接**（通讯）：从收音机到卫星通讯，连接全球幸存者
6. **繁荣**（交易/排行）：与其他开拓者合作竞争，重建文明

---

## 3. 核心游戏循环

### 3.1 主循环
```
圈地占领 → 探索搜刮 → 获得资源 → 建造/交易/消耗 → 发展壮大 → 圈更多地
```

### 3.2 日常循环
```
登录 → 检查体征（吃喝补给）→ 出门探索 → 搜刮POI → 回领地建造 → 发布交易 → 查看排行/成就
```

### 3.3 核心驱动力

| 驱动力 | 机制 |
|--------|------|
| 生存压力 | 饱食度/水分随时间衰减，必须持续探索 |
| 领地扩张 | 圈更多地 = 更多建筑位 = 更强实力 |
| 资源经济 | 资源有消耗出口（建造、生存），形成经济循环 |
| 社交竞争 | 排行榜 + 成就 + 交易，与其他玩家互动 |
| 收集欲 | 成就徽章收集，稀有度驱动 |

---

## 4. 系统设计

### 4.1 登录注册系统

**玩家入口**，提供三种登录方式：

| 方式 | 说明 |
|------|------|
| 邮箱注册 | 用户名 + 密码，传统方式 |
| Apple登录 | OAuth一键登录，iOS用户首选 |
| Google登录 | OAuth一键登录，海外用户首选 |

登录后创建"开拓者档案"，开始游戏。

---

### 4.2 GPS圈地系统

**核心玩法**，将现实步行转化为游戏领地。

#### 4.2.1 操作流程
1. 玩家在卫星地图上点击"开始圈地"
2. GPS实时追踪，地图上绘制**蓝色轨迹线**
3. 玩家步行绕一圈，回到起点附近（<50米）
4. 轨迹自动闭合，变成**绿色多边形**
5. 系统验证合法性
6. 验证通过 → 领地永久归属，显示面积

#### 4.2.2 验证规则

| 规则 | 说明 |
|------|------|
| 反作弊 | 移动速度不得超过正常步行/跑步速度，检测GPS跳变 |
| 无重叠 | 新领地不得与已有领地重叠 |
| 最小面积 | 圈地面积需达到最小阈值 |
| 闭合距离 | 起点终点距离 < 50米自动闭合 |

#### 4.2.3 地图表现

| 元素 | 视觉 |
|------|------|
| 玩家位置 | 蓝色光标 |
| 圈地轨迹 | 蓝色线条（进行中） |
| 已圈领地 | 绿色半透明多边形 |
| 他人领地 | 灰色半透明多边形 |

---

### 4.3 领地管理系统

每块领地是玩家的"家"，可管理和经营。

**领地属性：**
- 名称（玩家自定义）
- 面积（平方米）
- 建筑数量和列表
- 允许交易开关（开启后100米内可被发现）

**领地维护规则：**
- 30天内必须开始建设
- 90天内保持活跃
- 不满足条件则领地回收

---

### 4.4 POI探索与搜刮系统

**资源获取的核心途径**，基于真实世界地标。

#### 4.4.1 POI类型与资源映射

| POI类型 | 产出资源 | 示例地点 |
|---------|----------|----------|
| 医院/药店 | 药品（急救包、抗生素） | 现实中的医院、药房 |
| 超市/餐厅 | 食物（罐头、饮用水） | 现实中的超市、餐饮店 |
| 工厂/工地 | 金属材料 | 现实中的工业区 |
| 公园/林地 | 木材 | 现实中的公园、绿地 |
| 银行/珠宝店 | 稀有材料 | 现实中的银行、奢侈品店 |

#### 4.4.2 搜刮机制
- 进入POI **100米范围**内触发发现提示
- 点击"搜刮"获取资源
- 搜刮完成显示探索成就：距离、时长、获得物品
- 同一POI有冷却时间，不可重复无限搜刮

#### 4.4.3 探索奖励
- 探索距离和时长纳入统计
- 累计探索数据影响排行榜和成就

---

### 4.5 背包系统

**玩家资源存储中心。**

| 参数 | 值 |
|------|-----|
| 默认容量 | 100格 |
| 扩容方式 | 建造仓库 / 付费扩容 |

**物品分类：**
- 食物类（罐头、饮用水等）
- 药品类（急救包、抗生素等）
- 材料类（木材、石头、金属等）
- 稀有物品（卫星模块等）

**架构特性：**
- 本地优先存储：离线可查看和使用
- 网络恢复后自动同步至云端
- 容量满时提示玩家取舍

---

### 4.6 建造系统

**资源消耗和领地发展的核心。**

#### 4.6.1 建筑列表

**Tier 1 — 生存基础**

| 建筑 | 分类 | 消耗资源 | 功能 |
|------|------|----------|------|
| 篝火 | 生存 | 石头×20、木材×30 | 取暖、照明 |
| 庇护所 | 生存 | 木材×50、布料×20 | 休息、恢复 |
| 小仓库 | 储存 | 木材×40、金属×10 | 扩展背包容量 |

**Tier 2 — 功能扩展**

| 建筑 | 分类 | 消耗资源 | 功能 |
|------|------|----------|------|
| 农田 | 生产 | 木材×30、石头×20 | 生产食物 |
| 工作台 | 生产 | 金属×30、木材×20 | 制作物品 |
| 中仓库 | 储存 | 金属×40、木材×30 | 大幅扩展容量 |

**Tier 3 — 高级设施**

| 建筑 | 分类 | 消耗资源 | 功能 |
|------|------|----------|------|
| 太阳能板 | 能源 | 金属×50、稀有材料×10 | 供电 |
| 风力发电机 | 能源 | 金属×80、稀有材料×20 | 大量供电 |

#### 4.6.2 建造流程
1. 点击"建造"按钮进入建造菜单
2. 浏览分类（全部、生存、储存、生产、能源）
3. 选择建筑查看详情和资源需求
4. 点击"开始建造"
5. 系统检查资源是否充足
6. 充足 → 拖动选择领地内位置 → 开始施工
7. 不足 → 提示"建造失败，资源不足"

#### 4.6.3 建筑状态机

```
建造中 → 待激活 → 运行中 → 损坏
                    ↑         ↓
                    └── 维修 ──┘
```

| 状态 | 可执行操作 |
|------|------------|
| 建造中 | 等待（有建造时间） |
| 待激活 | 激活 |
| 运行中 | 升级、使用 |
| 损坏 | 维修 |

---

### 4.7 交易系统

**玩家间的资源流通。**

#### 4.7.1 交易模式
以物易物——不使用货币，直接物品交换。

#### 4.7.2 交易流程
1. 卖方在领地开启"允许交易"
2. 卖方发布挂单：选择"我提供"和"我需要"的物品
3. 买方进入卖方领地100米范围内
4. 买方看到挂单列表
5. 买方选择接受交易
6. 系统自动交换双方物品

#### 4.7.3 设计理念
- 基于位置的交易增强了"走出去"的动力
- 以物易物符合末日世界观
- 100米范围限制创造了面对面交易的沉浸感

---

### 4.8 通讯系统

**玩家间的连接纽带**，通过设备等级逐步解锁。

#### 4.8.1 通讯设备等级

| 等级 | 设备 | 能力 | 范围 |
|------|------|------|------|
| Lv.1 | 收音机 | 只能接收消息 | - |
| Lv.2 | 对讲机 | 收发文字/语音 | 3km |
| Lv.3 | 营地电台 | 收发+创建频道 | 10km |
| Lv.4 | 卫星通讯 | 全部功能 | 全球 |

#### 4.8.2 消息中心
- 系统推送：生存指南、每日任务、官方公告
- 所有设备等级均可接收系统消息

#### 4.8.3 公共频道
- 覆盖范围3km的区域聊天
- 需要对讲机（Lv.2）以上才能发送
- 实时消息推送

#### 4.8.4 自定义频道
- 玩家可创建/加入频道
- 显示频道名、距离、在线人数
- 需要营地电台（Lv.3）以上才能创建

#### 4.8.5 PTT呼叫
- 模拟真实无线电的Push to Talk
- 长按说话，松开发送
- 显示频率信息
- 需要对讲机（Lv.2）以上

---

### 4.9 生存体征系统

**持续游玩的核心驱动力。**

#### 4.9.1 体征参数

| 指标 | 满值 | 衰减速度 | 效果 |
|------|------|----------|------|
| 核心生命 | 100 | 饱食度/水分过低时下降 | 降至0 → 角色死亡 |
| 饱食度 | 100% | 每小时 -5 | < 20% → 持续掉血 |
| 水分 | 100% | 每小时 -10 | < 20% → 持续掉血 |

#### 4.9.2 增益与惩罚

| 条件 | 效果 |
|------|------|
| 饱食度 + 水分 > 80% | 获得探索效率增益 |
| 饱食度 或 水分 < 20% | 持续掉血，探索效率降低 |
| 核心生命 = 0 | 角色死亡（惩罚机制待定） |

#### 4.9.3 补充方式
- 消耗食物类物品恢复饱食度
- 消耗饮用水恢复水分
- 形成"探索→搜刮食物水→补充体征→继续探索"的循环

---

### 4.10 排行榜系统

**社交竞争和用户活跃驱动。**

| 榜单 | 排名依据 |
|------|----------|
| 领地面积榜 | 玩家总领地面积 |
| 探索废墟榜 | 累计搜刮次数/距离 |
| 建筑数量榜 | 已建造建筑总数 |

**技术实现：**
- 数据库窗口函数高效查询
- 5分钟缓存更新，减少数据库压力
- 支持10万+用户量级秒级响应

---

### 4.11 成就系统

**新手引导 + 长期目标。**

#### 4.11.1 成就分类

| 类别 | 示例 | 目标 |
|------|------|------|
| 新手成就 | "末世拾荒者"：完成第一次搜刮 | 引导新手熟悉功能 |
| 进阶成就 | "圈地大亨"：拥有5块领地 | 中期目标 |
| 稀有成就 | "末日建筑师"：建造所有类型建筑 | 长期挑战 |

#### 4.11.2 稀有度

| 稀有度 | 颜色 | 奖励倍率 |
|--------|------|----------|
| 普通 | 白色 | ×1 |
| 稀有 | 蓝色 | ×2 |
| 史诗 | 紫色 | ×5 |
| 传说 | 金色 | ×10 |

#### 4.11.3 触发机制
基于EventBus（事件总线）架构：
- 各系统完成操作后发出事件（如"圈地完成"、"搜刮完成"）
- 成就系统监听事件，检查是否达成条件
- 达成后弹出成就解锁通知，发放金币奖励

---

## 5. 经济系统

### 5.1 资源类型

| 资源 | 获取方式 | 用途 |
|------|----------|------|
| 木材 | 公园/林地搜刮 | 建造、升级 |
| 石头 | 各类POI搜刮 | 建造 |
| 金属 | 工厂/工地搜刮 | 建造高级建筑 |
| 食物 | 超市/餐厅搜刮 | 补充饱食度 |
| 饮用水 | 超市搜刮 | 补充水分 |
| 药品 | 医院/药店搜刮 | 恢复生命 |
| 布料 | 各类POI搜刮 | 建造庇护所 |
| 稀有材料 | 银行/珠宝店搜刮 | 建造高级设施 |

### 5.2 经济循环

```
探索搜刮（资源产出）
       ↓
  ┌────┴────┐
  ↓         ↓
建造消耗   生存消耗（食物/水）
  ↓
领地发展 → 交易流通 → 获取缺乏资源
```

### 5.3 付费经济

| 付费项目 | 价格 | 内容 |
|----------|------|------|
| 开拓者月卡 | $9.99/月 | 无限探索、范围扩大 |
| 领主通行证 | $19.99/月 | 全部特权 |
| 初级物资包 | $0.99 | 基础资源若干 |
| 中级物资包 | $2.99 | 中级资源若干 |
| 稀有资源包 | $9.99 | 包含稀有材料 |

---

## 6. UI/UX设计

### 6.1 主界面结构

```
┌──────────────────────────────┐
│         卫星地图（全屏）         │
│                              │
│   [玩家蓝色光标]               │
│                              │
│         [领地绿色多边形]        │
│                              │
│   ┌──────────────────────┐   │
│   │    开始圈地 / 搜刮      │   │
│   └──────────────────────┘   │
├──────────────────────────────┤
│  🗺地图  📦背包  🔨建造  📻通讯  👤个人 │
└──────────────────────────────┘
```

### 6.2 底部导航栏

| Tab | 功能 |
|-----|------|
| 地图 | 卫星地图、圈地、探索 |
| 背包 | 资源管理、物品使用 |
| 建造 | 建筑菜单、建筑管理 |
| 通讯 | 消息、频道、PTT、设备 |
| 个人 | 档案、成就、排行、体征、设置 |

### 6.3 通讯子页面

| 子Tab | 功能 |
|-------|------|
| 消息 | 官方消息、系统通知 |
| 公共频道 | 3km范围区域聊天 |
| 频道 | 自定义频道列表 |
| 呼叫 | PTT语音对讲 |
| 设备 | 通讯设备升级 |

### 6.4 个人中心子页面

| 子Tab | 功能 |
|-------|------|
| 档案 | 等级、天数、领地、面积 |
| 成就 | 成就列表、完成度 |
| 排行 | 三个排行榜 |
| 体征 | 生命、饱食度、水分 |
| 设置 | 语言、订阅、账户 |

---

## 7. 音频设计

| 场景 | 音效 |
|------|------|
| 主界面 | 低沉的环境音，偶尔的风声 |
| 圈地中 | 脚步声、GPS信号音 |
| 搜刮成功 | 开箱音效、物品掉落声 |
| 建造完成 | 锤击声、建筑落成音效 |
| 收到消息 | 无线电静噪声 |
| PTT通话 | 对讲机按键音、静噪声 |
| 成就解锁 | 胜利号角声 |
| 体征警告 | 心跳加速、警报声 |

---

## 8. 技术实现要点

### 8.1 核心技术栈

| 技术 | 用途 |
|------|------|
| Swift / SwiftUI | iOS原生前端 |
| Apple MapKit | 地图显示、POI数据（免费） |
| CoreLocation | GPS定位、地理围栏 |
| Supabase | 后端服务（Auth、Database、Realtime） |
| PostgreSQL + PostGIS | 地理空间数据库 |
| StoreKit 2 | 内购支付 |

### 8.2 关键架构模式

| 模式 | 应用场景 |
|------|----------|
| 本地优先 | 背包数据先存本地，异步同步云端 |
| 地理围栏 | POI发现、交易触发 |
| 发布-订阅（EventBus） | 成就系统事件驱动 |
| 状态机 | 建筑状态管理 |
| 实时推送 | 聊天消息、系统通知 |
| 窗口函数+缓存 | 排行榜高效查询 |

### 8.3 性能指标

| 指标 | 目标 |
|------|------|
| GPS轨迹延迟 | < 1秒 |
| 地理围栏触发 | 进入100米范围内即触发 |
| 消息送达延迟 | < 2秒 |
| 排行榜查询 | < 1秒（10万用户） |
| 地理空间查询 | < 500ms |
| 离线可用 | 背包查看和使用 |
